<!DOCTYPE html>
<html lang="pt-BR">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Quiz Nível Fácil | Olymp</title>
  <link rel="stylesheet" href="css/quizzes.css" />
</head>

<body>

  <!-- NAVBAR -->
  <header class="navbar">
    <div class="navbar-container">
      <div class="logo">
        <img src="./img/OlympLogotipo.svg" alt="Logo Olymp" />
      </div>

      <div class="menu-list">
        <ol class="nav-list">
          <li><a href="./index.html">Ínicio</a></li>
          <li><a href="./recomendacoes.html">Recomendações</a></li>
          <li><a href="./contos.html">Contos</a></li>
          <!-- Links visíveis só para usuário logado -->
          <li id="linkQuizzes" style="display: none;"><a href="./quiz.html">Quizzes</a></li>
          <li id="linkDashboard" style="display: none;"><a href="./dashboard.html">Dashboard</a></li>
        </ol>
      </div>

      <div class="nav-button" id="navButtons">
        <button>
          <a href="./login.html">Login</a>
        </button>

        <button>
          <a href="./cadastro.html"> Cadastre-se</a>
        </button>
      </div>
    </div>
  </header>

  <div class="quiz-wrapper">
    <div class="quiz-container">
      <div id="quiz">
        <h1>Quiz de Conhecimento</h1>
        <div class="pergunta-container">
          <h2 id="pergunta">Pergunta aqui</h2>
          <ul>
            <li><button class="botao-resposta" tabindex="0">Resposta 1</button></li>
            <li><button class="botao-resposta" tabindex="0">Resposta 2</button></li>
            <li><button class="botao-resposta" tabindex="0">Resposta 3</button></li>
            <li><button class="botao-resposta" tabindex="0">Resposta 4</button></li>
          </ul>
        </div>
        <button id="botao-proximo" class="botao" style="display: none;">Próxima Pergunta</button>
        <div id="resultado" style="display: none;">
          <h2>Seu resultado: <span id="pontuacao"></span></h2>
          <button id="botao-recomecar" class="botao" style="margin-top: 10px;">Recomeçar</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    function verificarLogin() {
      const usuarioLogado = sessionStorage.getItem("EMAIL_USUARIO");
      const navButtons = document.getElementById("navButtons");

      if (usuarioLogado) {
        document.getElementById("linkQuizzes").style.display = "block";
        document.getElementById("linkDashboard").style.display = "block";
        navButtons.innerHTML = `<button onclick="logout()">Logout</button>`;
      } else {
        document.getElementById("linkQuizzes").style.display = "none";
        document.getElementById("linkDashboard").style.display = "none";
        navButtons.innerHTML = `
          <button><a href="./login.html">Login</a></button>
          <button><a href="./cadastro.html">Cadastre-se</a></button>
        `;
      }
    }

    function logout() {
      sessionStorage.clear(); // limpa sessionStorage
      location.reload();
    }

    window.onload = verificarLogin;

    const perguntas = [
      {
        pergunta: "Quem era o deus do trovão na mitologia grega?",
        respostas: ["Hades", "Ares", "Zeus", "Apolo"],
        correta: "Zeus"
      },
      {
        pergunta: "Qual era a deusa do amor e da beleza?",
        respostas: ["Atena", "Ártemis", "Hera", "Afrodite"],
        correta: "Afrodite"
      },
      {
        pergunta: "Quem era o deus dos mares?",
        respostas: ["Hermes", "Poseidon", "Dionísio", "Cronos"],
        correta: "Poseidon"
      },
      {
        pergunta: "Qual era o nome do cavalo alado da mitologia grega?",
        respostas: ["Minotauro", "Grifo", "Pégaso", "Centauro"],
        correta: "Pégaso"
      },
      {
        pergunta: "Quem era o deus mensageiro, conhecido por suas sandálias aladas?",
        respostas: ["Hermes", "Apolo", "Dionísio", "Hefesto"],
        correta: "Hermes"
      },
      {
        pergunta: "Onde os deuses do Olimpo viviam?",
        respostas: ["Monte Etna", "Monte Olimpo", "Monte Parnaso", "Monte Atlas"],
        correta: "Monte Olimpo"
      },
      {
        pergunta: "Quem era a deusa da sabedoria e da guerra estratégica?",
        respostas: ["Deméter", "Atena", "Hera", "Afrodite"],
        correta: "Atena"
      },
      {
        pergunta: "Qual criatura tinha cabeça de touro e corpo de homem?",
        respostas: ["Quimera", "Minotauro", "Cérbero", "Centauro"],
        correta: "Minotauro"
      }
    ];

    let indice = 0;
    let acertos = 0;
    let erros = 0;

    const perguntaElement = document.getElementById("pergunta");
    const opcoesElement = document.querySelectorAll(".botao-resposta");
    const botaoProximo = document.getElementById("botao-proximo");
    const resultadoElement = document.getElementById("resultado");
    const pontuacaoElement = document.getElementById("pontuacao");
    const botaoRecomecar = document.getElementById("botao-recomecar");

    function carregarPergunta() {
      const perguntaAtual = perguntas[indice];
      perguntaElement.innerText = perguntaAtual.pergunta;

      opcoesElement.forEach((botao, i) => {
        botao.innerText = perguntaAtual.respostas[i];
        botao.disabled = false;
        botao.classList.remove("correto", "incorreto");

        botao.onclick = () => verificarResposta(botao, perguntaAtual.correta);
      });

      botaoProximo.style.display = "none";
    }

    function verificarResposta(botaoSelecionado, correta) {
      if (botaoSelecionado.innerText === correta) {
        botaoSelecionado.classList.add("correto");
        acertos++;
      } else {
        botaoSelecionado.classList.add("incorreto");
        erros++;
      }

      opcoesElement.forEach(botao => {
        botao.disabled = true;
        if (botao.innerText === correta) {
          botao.classList.add("correto");
        }
      });

      botaoProximo.style.display = "block";
    }

    function mostrarResultado() {
      resultadoElement.style.display = "block";
      pontuacaoElement.innerText = `${acertos} de ${perguntas.length}`;

      const percentual = ((acertos / perguntas.length) * 100).toFixed(2);

      const idUsuario = sessionStorage.ID_USUARIO;
      const fkQuiz = 1;

      if (!idUsuario) {
        console.warn("Usuário não está logado, resultado não será enviado.");
        return;
      }

      fetch("/quiz/cadastrar", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          idUsuarioServer: idUsuario,
          fkQuizServer: fkQuiz,
          total_perguntasServer: perguntas.length,
          acertosServer: acertos,
          percentualServer: percentual
        }),
      })
        .then(res => {
          if (res.ok) {
            console.log("Resultado enviado com sucesso");
          } else {
            console.error("Falha ao enviar resultado");
          }
        })
        .catch(err => console.error("Erro na requisição:", err));
    }

    botaoProximo.addEventListener("click", () => {
      indice++;
      if (indice < perguntas.length) {
        carregarPergunta();
      } else {
        mostrarResultado();
      }
    });

    botaoRecomecar.addEventListener("click", () => {
      indice = 0;
      acertos = 0;
      erros = 0;
      resultadoElement.style.display = "none";
      carregarPergunta();
    });

    carregarPergunta();
  </script>

</body>

</html>
