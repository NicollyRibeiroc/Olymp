<!DOCTYPE html>
<html lang="pt-BR">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Quiz Nível Fácil | Olymp</title>
  <link rel="stylesheet" href="css/quizzes.css" />
</head>

<body>

  <!-- NAVBAR -->
  <header class="navbar">
    <div class="navbar-container">
      <div class="logo">
        <img src="./img/OlympLogotipo.svg" alt="Logo Olymp" />
      </div>

      <div class="menu-list">
        <ol class="nav-list">
          <li><a href="./index.html">Ínicio</a></li>
          <li><a href="./recomendacoes.html">Recomendações</a></li>
          <li><a href="./contos.html">Contos</a></li>
          <!-- Links visíveis só para usuário logado -->
          <li id="linkQuizzes" style="display: none;"><a href="./quiz.html">Quizzes</a></li>
          <li id="linkDashboard" style="display: none;"><a href="./dashboard.html">Dashboard</a></li>
        </ol>
      </div>

      <div class="nav-button" id="navButtons">
        <button>
          <a href="./login.html">Login</a>
        </button>

        <button>
          <a href="./cadastro.html"> Cadastre-se</a>
        </button>
      </div>
    </div>
  </header>

  <div class="quiz-wrapper">
    <div class="quiz-container">
      <div id="quiz">
        <h1>Quiz de Conhecimento</h1>
        <div class="pergunta-container">
          <h2 id="pergunta">Pergunta aqui</h2>
          <ul>
            <li><button class="botao-resposta">Resposta 1</button></li>
            <li><button class="botao-resposta">Resposta 2</button></li>
            <li><button class="botao-resposta">Resposta 3</button></li>
            <li><button class="botao-resposta">Resposta 4</button></li>
          </ul>
        </div>
        <button id="botao-proximo" class="botao" style="display: none;">Próxima Pergunta</button>
        <div id="resultado" style="display: none;">
          <h2>Seu resultado: <span id="pontuacao"></span></h2>
          <button id="botao-recomecar" class="botao" style="margin-top: 10px;">Recomeçar</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    function verificarLogin() {
      const usuarioLogado = sessionStorage.getItem("EMAIL_USUARIO");

      if (usuarioLogado) {
        document.getElementById("linkQuizzes").style.display = "block";
        document.getElementById("linkDashboard").style.display = "block";

        const navButtons = document.getElementById("navButtons");
        navButtons.innerHTML = `<button onclick="logout()">Logout</button>`;
      } else {
        document.getElementById("linkQuizzes").style.display = "none";
        document.getElementById("linkDashboard").style.display = "none";

        const navButtons = document.getElementById("navButtons");
        navButtons.innerHTML = `
            <button><a href="./login.html">Login</a></button>
            <button><a href="./cadastro.html">Cadastre-se</a></button>
        `;
      }
    }

    function logout() {
      sessionStorage.clear(); // limpa sessionStorage
      location.reload();
    }

    window.onload = verificarLogin;
    const perguntas = [
      {
        pergunta: "Quem era o deus do trovão na mitologia grega?",
        respostas: ["Hades", "Ares", "Zeus", "Apolo"],
        correta: "Zeus"
      },
      {
        pergunta: "Qual era a deusa do amor e da beleza?",
        respostas: ["Atena", "Ártemis", "Hera", "Afrodite"],
        correta: "Afrodite"
      },
      {
        pergunta: "Quem era o deus dos mares?",
        respostas: ["Hermes", "Poseidon", "Dionísio", "Cronos"],
        correta: "Poseidon"
      },
      {
        pergunta: "Qual era o nome do cavalo alado da mitologia grega?",
        respostas: ["Minotauro", "Grifo", "Pégaso", "Centauro"],
        correta: "Pégaso"
      },
      {
        pergunta: "Quem era o deus mensageiro, conhecido por suas sandálias aladas?",
        respostas: ["Hermes", "Apolo", "Dionísio", "Hefesto"],
        correta: "Hermes"
      },
      {
        pergunta: "Onde os deuses do Olimpo viviam?",
        respostas: ["Monte Etna", "Monte Olimpo", "Monte Parnaso", "Monte Atlas"],
        correta: "Monte Olimpo"
      },
      {
        pergunta: "Quem era a deusa da sabedoria e da guerra estratégica?",
        respostas: ["Deméter", "Atena", "Hera", "Afrodite"],
        correta: "Atena"
      },
      {
        pergunta: "Qual criatura tinha cabeça de touro e corpo de homem?",
        respostas: ["Quimera", "Minotauro", "Cérbero", "Centauro"],
        correta: "Minotauro"
      }
    ];

    let indicePerguntaAtual = 0;
    let pontuacao = 0;

    const elementoPergunta = document.getElementById("pergunta");
    let botoesResposta = document.querySelectorAll(".botao-resposta");
    const botaoProximo = document.getElementById("botao-proximo");
    const containerResultado = document.getElementById("resultado");
    const elementoPontuacao = document.getElementById("pontuacao");
    const botaoRecomecar = document.getElementById("botao-recomecar");

    function iniciarQuiz() {
      indicePerguntaAtual = 0;
      pontuacao = 0;
      botaoProximo.style.display = "none";
      containerResultado.style.display = "none";
      exibirPergunta();
    }

    function exibirPergunta() {
      resetarEstado();
      const perguntaAtual = perguntas[indicePerguntaAtual];
      elementoPergunta.innerText = perguntaAtual.pergunta;

      // Atualiza os botões clonando para remover listeners antigos
      botoesResposta.forEach((botao, index) => {
        const novoBotao = botao.cloneNode(true);
        novoBotao.innerText = perguntaAtual.respostas[index];
        botao.parentNode.replaceChild(novoBotao, botao);
      });

      // Atualiza a lista para os novos botões clonados
      botoesResposta = document.querySelectorAll(".botao-resposta");

      // Adiciona listener aos botões
      botoesResposta.forEach(botao => {
        botao.addEventListener("click", selecionarResposta);
      });
    }

    function resetarEstado() {
      botaoProximo.style.display = "none";
      botoesResposta.forEach(botao => {
        botao.disabled = false;
        botao.classList.remove("correto", "incorreto");
      });
    }

    function selecionarResposta(e) {
      const botaoSelecionado = e.target;
      const respostaCorreta = perguntas[indicePerguntaAtual].correta;

      // Marca o botão selecionado como correto ou incorreto
      if (botaoSelecionado.innerText === respostaCorreta) {
        botaoSelecionado.classList.add("correto");
        pontuacao++;
      } else {
        botaoSelecionado.classList.add("incorreto");
      }

      // Marca o botão correto para feedback visual
      botoesResposta.forEach(botao => {
        if (botao.innerText === respostaCorreta) {
          botao.classList.add("correto");
        }
        botao.disabled = true;
      });

      botaoProximo.style.display = "block";
    }

    function exibirResultado() {
      containerResultado.style.display = "block";
      elementoPontuacao.innerText = `${pontuacao} de ${perguntas.length}`;

      var idUsuario = sessionStorage.ID_USUARIO
      var fkQuiz = 1
      var perguntasTotal = perguntas.length
      var percentual = ((pontuacao / perguntas.length) * 100)
      var percentual2 = percentual.toFixed(2)

      fetch("/quizfacil/cadastrar", {
        method: "POST",
        headers: {
          "Content-Type": "application/json"
        },
        body: JSON.stringify({
                idUsuarioServer: idUsuario,
                fkQuizServer: fkQuiz,
                total_perguntasServer: perguntasTotal,
                acertosServer: pontuacao,
                percentualServer: percentual2

            })
      })
        .then(response => response.json())
        .then(data => {
          console.log("Dados salvos com sucesso:", data);
        })
        .catch(error => {
          console.error("Erro ao salvar desempenho:", error);
        });
    }

    botaoProximo.addEventListener("click", () => {
      indicePerguntaAtual++;
      if (indicePerguntaAtual < perguntas.length) {
        exibirPergunta();
      } else {
        exibirResultado();
      }
    });

    botaoRecomecar.addEventListener("click", iniciarQuiz);

    iniciarQuiz();


  </script>

</body>

</html>