<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Quiz Nível Médio | Olymp</title>
    <link rel="stylesheet" href="css/quizzes.css" />
</head>

<body>

    <!-- NAVBAR -->
    <header class="navbar">
        <div class="navbar-container">
            <div class="logo">
                <img src="./img/OlympLogotipo.svg" alt="Logo Olymp" />
            </div>

            <div class="menu-list">
                <ol class="nav-list">
                    <li><a href="./index.html">Ínicio</a></li>
                    <li><a href="./recomendacoes.html">Recomendações</a></li>
                    <li><a href="./contos.html">Contos</a></li>
                    <!-- Links visíveis só para usuário logado -->
                    <li id="linkQuizzes" style="display: none;"><a href="./quiz.html">Quizzes</a></li>
                    <li id="linkDashboard" style="display: none;"><a href="./dashboard.html">Dashboard</a></li>
                </ol>
            </div>

            <div class="nav-button" id="navButtons">
                <button>
                    <a href="./login.html">Login</a>
                </button>

                <button>
                    <a href="./cadastro.html"> Cadastre-se</a>
                </button>
            </div>
        </div>
    </header>

    <div class="quiz-wrapper">
        <div class="quiz-container">
            <div id="quiz">
                <h1>Quiz de Conhecimento</h1>
                <div class="pergunta-container">
                    <h2 id="pergunta">Pergunta aqui</h2>
                    <ul>
                        <li><button class="botao-resposta">Resposta 1</button></li>
                        <li><button class="botao-resposta">Resposta 2</button></li>
                        <li><button class="botao-resposta">Resposta 3</button></li>
                        <li><button class="botao-resposta">Resposta 4</button></li>
                    </ul>
                </div>
                <button id="botao-proximo" class="botao" style="display: none;">Próxima Pergunta</button>
                <div id="resultado" style="display: none;">
                    <h2>Seu resultado: <span id="pontuacao"></span></h2>
                    <button id="botao-recomecar" class="botao" style="margin-top: 10px;">Recomeçar</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Verifica se o usuário está logado para mostrar links específicos
        function verificarLogin() {
            const usuarioLogado = sessionStorage.getItem("EMAIL_USUARIO");

            if (usuarioLogado) {
                document.getElementById("linkQuizzes").style.display = "block";
                document.getElementById("linkDashboard").style.display = "block";

                const navButtons = document.getElementById("navButtons");
                navButtons.innerHTML = `<button onclick="logout()">Logout</button>`;
            } else {
                document.getElementById("linkQuizzes").style.display = "none";
                document.getElementById("linkDashboard").style.display = "none";

                const navButtons = document.getElementById("navButtons");
                navButtons.innerHTML = `
            <button><a href="./login.html">Login</a></button>
            <button><a href="./cadastro.html">Cadastre-se</a></button>
        `;
            }
        }

        function logout() {
            sessionStorage.clear(); // limpa sessionStorage
            location.reload();
        }

        window.onload = verificarLogin;

        const perguntas = [
            { pergunta: "Quem era o rei dos deuses na mitologia grega?", respostas: ["Apolo", "Poseidon", "Zeus", "Hades"], correta: "Zeus" },
            { pergunta: "Qual deusa nasceu da espuma do mar?", respostas: ["Ártemis", "Afrodite", "Deméter", "Hera"], correta: "Afrodite" },
            { pergunta: "Qual deus era responsável pelo submundo?", respostas: ["Zeus", "Hades", "Hermes", "Ares"], correta: "Hades" },
            { pergunta: "Quem era o mensageiro dos deuses?", respostas: ["Hermes", "Apolo", "Dionísio", "Ares"], correta: "Hermes" },
            { pergunta: "Qual deus era associado ao vinho e festas?", respostas: ["Dionísio", "Ares", "Hefesto", "Poseidon"], correta: "Dionísio" },
            { pergunta: "Quem era a deusa da sabedoria?", respostas: ["Hera", "Deméter", "Afrodite", "Atena"], correta: "Atena" },
            { pergunta: "Quem era o deus dos mares?", respostas: ["Zeus", "Hades", "Poseidon", "Apolo"], correta: "Poseidon" },
            { pergunta: "Quem foi punido a segurar o céu nos ombros?", respostas: ["Prometeu", "Atlas", "Cronos", "Orfeu"], correta: "Atlas" },
            { pergunta: "Quem matou a Medusa?", respostas: ["Teseu", "Hércules", "Perseu", "Aquiles"], correta: "Perseu" },
            { pergunta: "Qual herói era invulnerável, exceto no calcanhar?", respostas: ["Aquiles", "Hércules", "Ulisses", "Teseu"], correta: "Aquiles" }
        ];

        let indicePerguntaAtual = 0;
        let pontuacao = 0;

        const elementoPergunta = document.getElementById("pergunta");
        const botoesResposta = document.querySelectorAll(".botao-resposta");
        const botaoProximo = document.getElementById("botao-proximo");
        const containerResultado = document.getElementById("resultado");
        const elementoPontuacao = document.getElementById("pontuacao");

        function iniciarQuiz() {
            indicePerguntaAtual = 0;
            pontuacao = 0;
            botaoProximo.style.display = "none";
            containerResultado.style.display = "none";
            exibirPergunta();
        }

        function exibirPergunta() {
            resetarEstado();
            const perguntaAtual = perguntas[indicePerguntaAtual];
            elementoPergunta.innerText = perguntaAtual.pergunta;

            botoesResposta.forEach((botao, index) => {
                botao.innerText = perguntaAtual.respostas[index];
                botao.onclick = selecionarResposta;
            });
        }

        function resetarEstado() {
            botaoProximo.style.display = "none";
            botoesResposta.forEach(botao => {
                botao.disabled = false;
                botao.classList.remove("correto", "incorreto");
            });
        }

        function selecionarResposta(e) {
            const botaoSelecionado = e.target;
            const respostaCorreta = botaoSelecionado.innerText === perguntas[indicePerguntaAtual].correta;

            if (respostaCorreta) {
                botaoSelecionado.classList.add("correto");
                pontuacao++;
            } else {
                botaoSelecionado.classList.add("incorreto");
            }

            botoesResposta.forEach(botao => botao.disabled = true);
            botaoProximo.style.display = "block";
        }

        function exibirResultado() {
            containerResultado.style.display = "block";
            elementoPontuacao.innerText = `${pontuacao} de ${perguntas.length}`;

            // Pegando o ID do usuário salvo na sessionStorage
            const idUsuario = sessionStorage.getItem("ID_USUARIO");
            const fkQuiz = 2; // ID do quiz médio
            const totalPerguntas = perguntas.length;
            const percentual = ((pontuacao / totalPerguntas) * 100).toFixed(2);

            fetch("/quiz/cadastrar", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({
                    idUsuarioServer: idUsuario,
                    fkQuizServer: fkQuiz,
                    total_perguntasServer: totalPerguntas,
                    acertosServer: pontuacao,
                    percentualServer: percentual
                })
            })
                .then(response => response.json())
                .then(data => {
                    console.log("Dados salvos com sucesso:", data);
                })
                .catch(error => {
                    console.error("Erro ao salvar desempenho:", error);
                });
        }

        botaoProximo.addEventListener("click", () => {
            indicePerguntaAtual++;
            if (indicePerguntaAtual < perguntas.length) {
                exibirPergunta();
            } else {
                exibirResultado();
            }
        });

        document.getElementById("botao-recomecar").addEventListener("click", iniciarQuiz);

        iniciarQuiz();

    </script>

</body>

</html>
