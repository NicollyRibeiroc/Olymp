<!DOCTYPE html>
<html lang="pt-br">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Dashboard | Olymp</title>
  <link rel="stylesheet" href="./css/dashboards.css">
</head>

<body>
  <aside class="sidebar">
    <div class="user-name" id="userName">Ol√°, @</div>
    <nav>
      <a href="./index.html">Home</a>
      <a href="./quizzes.html">Quizzes</a>
    </nav>
  </aside>

  <div class="content">
    <div class="kpis-container">
      <div class="kpi">
        Taxa Quiz F√°cil
        <div class="value" id="kpi-facil" style="color:#4caf50;">90%</div>
        <div class="kpi-subtitle">Desempenho no n√≠vel F√°cil</div>
      </div>
      <div class="kpi">
        Taxa Quiz M√©dio
        <div class="value" id="kpi-medio" style="color:#ffc107;">60%</div>
        <div class="kpi-subtitle">Desempenho no n√≠vel M√©dio</div>
      </div>
      <div class="kpi">
        Taxa Quiz D√≠ficil
        <div class="value" id="kpi-dificil" style="color:#f44336;">30%</div>
        <div class="kpi-subtitle">Desempenho no n√≠vel D√≠ficil</div>
      </div>
    </div>

    <div class="main-container">
      <div class="container">
        <canvas id="myChart"></canvas>
      </div>

      <div id="ranking">
        <div class="ranking">
          <h3>üèÜ Ranking dos Jogadores</h3>
          <ol id="ranking-list"></ol>
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <!-- <script>
    // s√≥ entra se estiver logado
    if (!sessionStorage.ID_USUARIO) {
      alert("Voc√™ precisa estar logado para acessar a Dashboard.");
      window.location.href = "login.html";
    } else {
      // Atualiza nome do usu√°rio
      const nomeUsuario = sessionStorage.NOME_USUARIO || "@";
      document.getElementById("userName").textContent = "Ol√°, " + nomeUsuario;
    }

    let chart;

        function calcularTaxa(acertos, erros) {
          acertos = Number(acertos);
          erros = Number(erros);
          const tentativas = acertos + erros;
          if (tentativas === 0) return '0.00%';
          return ((acertos / tentativas) * 100).toFixed(2) + '%';
        }

        document.getElementById('kpi-facil').textContent = calcularTaxa(dados.facil.acertos, dados.facil.erros);
        document.getElementById('kpi-medio').textContent = calcularTaxa(dados.medio.acertos, dados.medio.erros);
        document.getElementById('kpi-dificil').textContent = calcularTaxa(dados.dificil.acertos, dados.dificil.erros);

        const ctx = document.getElementById('myChart').getContext('2d');
        if (chart) chart.destroy();

        chart = new Chart(ctx, {
          type: 'bar',
          data: {
            labels: ['F√°cil', 'M√©dio', 'D√≠ficil'],
            datasets: [
              {
                label: 'Quantidade de Acertos',
                data: [dados.facil.acertos, dados.medio.acertos, dados.dificil.acertos],
                backgroundColor: 'rgba(76, 175, 80, 0.7)',
                borderWidth: 1,
                borderColor: 'rgb(76, 175, 80)',
              },
              {
                label: 'Quantidade de Erros',
                data: [dados.facil.erros, dados.medio.erros, dados.dificil.erros],
                backgroundColor: 'rgba(244, 67, 54, 0.7)',
                borderWidth: 1,
                borderColor: 'rgb(244, 67, 54)',
              },
              {
                label: 'Tentativas Totais',
                data: [dados.facil.tentativas, dados.medio.tentativas, dados.dificil.tentativas],
                backgroundColor: 'rgba(255, 193, 7, 0.7)',
                borderWidth: 1,
                borderColor: 'rgb(255, 193, 7)',
              },
            ],
          },
          options: {
            animation: {
              duration: 2000,
              easing: 'easeOutBounce',
            },
            layout: {
              padding: {
                left: 20,
                right: 20,
                top: 20,
                bottom: 50,
              },
            },
            plugins: {
              legend: {
                display: true,
                position: 'bottom',
              },
              title: {
                display: true,
                text: 'Desempenho dos Jogadores por Dificuldade',
                font: {
                  size: 30,
                  weight: 'bold',
                  family: 'Arial',
                },
                color: 'black',
              },
              tooltip: {
                enabled: true,
                backgroundColor: 'rgb(0,0,0)',
              },
            },
            scales: {
              y: {
                beginAtZero: true,
                grid: { display: false },
                ticks: {
                  color: 'black',
                  font: { size: 14, weight: 'bold' },
                },
              },
              x: {
                ticks: {
                  color: 'black',
                  font: { size: 14, weight: 'bold' },
                },
              },
            },
          },
        });
      } catch (error) {
        console.error('Erro ao carregar desempenho:', error);
      }
    }

    async function carregarRanking() {
      try {
        const resposta = await fetch('http://localhost:3001/api/ranking');
        const dados = await resposta.json();

        const lista = document.getElementById('ranking-list');
        lista.innerHTML = '';

        dados.forEach((item, index) => {
          const li = document.createElement('li');
          li.innerText = `${index + 1}¬∫ ${item.nome} ‚Äî ${item.pontuacao}%`;
          lista.appendChild(li);
        });
      } catch (erro) {
        console.error('Erro ao carregar ranking:', erro);
      }
    }

    function atualizarRanking() {
      fetch('http://localhost:3001/api/ranking')
        .then((res) => res.json())
        .then((dados) => {
          const lista = document.getElementById('ranking-list');
          lista.innerHTML = '';
          dados.forEach((item, index) => {
            const li = document.createElement('li');
            li.innerText = `${index + 1}¬∫ ${item.nome} ‚Äî ${item.pontuacao}%`;
            lista.appendChild(li);
          });
        })
        .catch((erro) => console.error('Erro ao atualizar ranking:', erro));
    }

    window.onload = async () => {
      await carregarDesempenho();
      await carregarRanking();
      setInterval(atualizarRanking, 10000);
    };
  </script> -->
</body>

</html>
